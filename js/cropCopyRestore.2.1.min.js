// Crop copy responsively, to user-defined number of lines, then restore onclick - v2.1 (IE9+) - 23/01/2017 - M.J.Foskett - https://websemantics.uk/
var cropCopyRestore=function(e,t){"use strict";function n(e,t){return e.substring(0,e.lastIndexOf(t))}function i(e){return e.replace(/[ .,!?:;"“‘'\-]+$/,"")}function r(e,t){e.querySelector("."+A).textContent=t}function o(e){r(e,e.croppedText+T),e.innerHTML.match("visually-hidden")||(e.innerHTML+=w)}function a(e,t){e.setAttribute("aria-expanded",t)}function s(t){function n(e){r(e,e.fullText),e.removeChild(e.querySelector(".visually-hidden")),a(e,!0)}e.requestAnimationFrame?e.requestAnimationFrame(function(){n(t)}):n(t)}function l(e){e&&(o(e),a(e,!1))}function c(e,t){var n=e.cloneNode(!0);return n.classList.add(H),n.querySelector("."+A)&&(n.querySelector("."+A).textContent=t,e.parentNode.insertBefore(n,e.nextSibling),n.initialHeight=n.clientHeight),n}function u(e){var t=c(e,e.croppedText);return e.parentNode.removeChild(t),t.initialHeight}function d(e){var t=c(e,e.fullText);return e.parentNode.removeChild(t),t.initialHeight}function p(e){var t=e.fullText.split(" "),o=0,a=1,s=c(e,t[o]+" "),l=s.querySelector("."+A);for(o=1;o<t.length;o++){if(l.textContent+=t[o]+T,s.clientHeight!==s.initialHeight){if(a+""===e.noOfLines){r(s,n(l.textContent,t[o]+T)),e.croppedMaxHeight=s.clientHeight,e.parentNode.setAttribute("style","max-height:"+e.croppedMaxHeight+"px");break}a++,s.initialHeight=s.clientHeight}r(s,l.textContent.replace(t[o]+T,t[o]+" "))}return r(s,i(l.textContent)),e.parentNode.removeChild(s),l.textContent}function f(t){var n=t.target.p;delete t.target.p,t.target.removeEventListener(e.transitionEnd,f),l(n)}function v(e){return e&&e.classList.contains(R)?e:null===e.parentNode?!1:v(e.parentNode)}function h(t){var n=v(t.target);n&&("true"===n.getAttribute("aria-expanded")?(n.parentNode.style.maxHeight=u(n)+"px",n.parentNode.classList.remove(E),n.parentNode.p=n,e.transitionEnd?n.parentNode.addEventListener(e.transitionEnd,f,!1):l(n)):(n.parentNode.style.maxHeight=d(n)+"px",n.parentNode.classList.add(E),s(n))),t.preventDefault()}function x(e){13!==e.which&&32!==e.which||h(e)}function m(e){e.addEventListener("click",h,!1),e.addEventListener("keydown",x,!1)}function g(e){e.removeEventListener("click",h),e.removeEventListener("keydown",x)}function C(e,t){var n=e.getAttribute(b);e.noOfLines=/^([1-9]\d*)$/.test(n)?n:"1",e.fullText=e.textContent.trim(),e.setAttribute("id",e.id||N+t),e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-controls",e.id)}function y(e){e.innerHTML=k+"<span role=alert aria-live=assertive class="+A+">"+e.innerHTML+"</span>"}function L(){for(var e,n=t.querySelectorAll("["+b+"]"),i=n.length;i--;)e=n[i],e.fullText?(e.parentNode.classList.remove(E),g(e)):(y(e),C(e,i)),a(e,!1),e.croppedText=p(e),o(e),m(e)}var b="data-cropCopyRestore",N="CCR_btn-",T="…",H="CCR-clone",E="CCR-expanded",R="CCR_txt",A="CCR_copy",k="<span class=CCR_icon><svg class=CCR_svg focussable=false><use class=CCR_use-plus xlink:href=#icon-vert></use><use xlink:href=#icon-hori></use></svg></span>",w="<span class=visually-hidden> [Read more]</span>",M=function(e,t,n){var i;return function(){var r=this,o=arguments,a=function(){i=null,n||e.apply(r,o)},s=n&&!i;clearTimeout(i),i=setTimeout(a,t||200),s&&e.apply(r,o)}};!function(e){var n={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend"},i=t.createElement("div");for(var r in n)if("undefined"!=typeof i.style[r]){e.transitionEnd=n[r];break}}(e),"classList"in t.documentElement||!Object.defineProperty||"undefined"==typeof HTMLElement||Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){function e(e){return function(n){var i=t.className.split(/\s+/),r=i.indexOf(n);e(i,r,n),t.className=i.join(" ")}}var t=this,n={add:e(function(e,t,n){~t||e.push(n)}),remove:e(function(e,t){~t&&e.splice(t,1)}),toggle:e(function(e,t,n){~t?e.splice(t,1):e.push(n)}),contains:function(e){return!!~t.className.split(/\s+/).indexOf(e)},item:function(e){return t.className.split(/\s+/)[e]||null}};return Object.defineProperty(n,"length",{get:function(){return t.className.split(/\s+/).length}}),n}}),L(),e.addEventListener("resize",M(L,100,!1),!1)}(window,document);

window.addEventListener("load",cropCopyRestore,!1);